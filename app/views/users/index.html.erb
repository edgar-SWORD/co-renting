<div class="padding-section-large">
  <div class="container">
    <h1 class="mb-5"><%= @users.count %> profils similaires</h1>
    <%= form_with url: users_path, method: :get, local: true, class: "mb-4" do %>
      <div class="row">
        <div class="col-md-3 mb-3">
          <%= text_field_tag :location, params[:location], placeholder: "Localisation", class: "form-control custom-input" %>
        </div>
        <div class="col-md-3 mb-3">
          <%= select_tag :rythm, options_for_select([['Rythme', ''], ['All Week', 'all week'], ['Week-Days', 'week-days'], ['Week-Ends', 'week-ends']], params[:rythm]), class: "form-control custom-input" %>
        </div>
        <div class="col-md-3 mb-3">
          <%= select_tag :alternance, options_for_select([['Alternance', ''], ['Even', 'even'], ['Odd', 'odd']], params[:alternance]), class: "form-control custom-input" %>
        </div>
        <div class="col-md-3">
          <%= submit_tag "Affiner ma recherche", class: "button-form" %>
        </div>
      </div>
    <% end %>

<div class="container col-5 mx-2">
    <div class="top-sticky" style="width: 100%; height: 460px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>

<div class="layout mt-5">
  <div class="row">
    <% @users.each do |user| %>
      <div class="col-lg-3 col-md-4 col-sm-6 my-3">
        <%= link_to user_path(user), class:"card-link" do  %>
          <div class="card h-100">
            <div class="card-img-top" style="background-image: url('<%= user.avatar_url.present? ? user.avatar_url : 'path/to/placeholder-image.jpg' %>'); background-size: cover; background-position: center; height: 200px; position: relative;">
              <span class="badge badge-light top-10 start-10">Semaine <%= user.alternance %></span>
                <span class="favorite-icon top-10 end-10"><i class="far fa-heart"></i></span>
            </div>
            <div class="card-body">
              <div class="card-body-top">
                <h5 class="card-title"><%= user.first_name %></h5>
                <p class="card-price"><%= number_to_currency(user.max_budget || 750, unit: "â‚¬") %>/mois</p>
              </div>
              <p class="card-text"><%= user.children.count %> enfants</p>
              <p class="card-text mt-1">Occupe la location <%= user.rythm %></p>
              <div class="tags mt-3">
                <% user.profile_researches.first&.flat&.flat_perks&.each do |flat_perk| %>
                  <span class="badge badge-secondary"><%= flat_perk.perk.name %></span>
                <% end %>
              </div>
            </div>
          </div>
          <% end %>
      </div>
    <% end %>
  </div>
</div>


  </div>
</div>
